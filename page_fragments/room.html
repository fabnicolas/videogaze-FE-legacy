<head>
    <link href="http://vjs.zencdn.net/6.6.3/video-js.css" rel="stylesheet">
  
    <!-- If you'd like to support IE8 -->
    <script src="http://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js"></script>
</head>

<div class="content" id="video_player_container">
</div>

<script type="text/javascript">
    JSLoader.load("room.js",function(){
        JSLoader.load("video_player.js",function(){
            Room.init(SPA.getVar('roomcode'),function(response){
                if(response.status==1){
                    set_room_content(response.message);
                }
            });
        });
    });

    function set_room_content(room_data){
        VideoJSPlayer.init(function(){
            window.history.replaceState({}, document.title, './index.php?roomcode='+room_data.roomcode);
            SPA.setVar("roomcode",room_data.roomcode);
            SPA.setVar("video_to_play",room_data.stream_key);
            var video_to_play = room_data.stream_key;
            if(room_data.stream_type=='local'){
                VideoJSPlayer.inject_local_video_player(
                    document.getElementById("video_player_container"),
                    "my_video",
                    video_to_play,
                    '',
                    function(){
                        Room.attach_videojs_handler("my_video");
                    }
                );
            }else if(room_data.stream_type=='youtube'){
                VideoJSPlayer.inject_youtube_video_player(
                    document.getElementById("video_player_container"),
                    "my_video",
                    video_to_play,
                    '',
                    function(){
                        Room.attach_videojs_handler("my_video",function(){
                            console.log("CONTROLS ATTACHED!");
                            Room.start_sync(true);
                        });
                    }
                );
            }
        });
    }
</script>